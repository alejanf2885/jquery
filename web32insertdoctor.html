<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hospitales</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
  </head>
  <style>
    .atext-light:hover {
      color: white !important;
    }
  </style>
  <body>
    <header>
      <nav
        class="navbar navbar-expand-md navbar-dark bg-primary shadow-sm py-3"
      >
        <div class="container">
          <a
            class="navbar-brand fw-bold d-flex align-items-center gap-2"
            href="web31practicaFinalDoctores.html"
          >
            <i class="bi bi-hospital fs-4"></i>
            Doctores
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapsibleNavId"
            aria-controls="collapsibleNavId"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a
                  class="nav-link active fw-bold d-flex align-items-center gap-1"
                  href="web31practicaFinalDoctores.html"
                  aria-current="page"
                >
                  <i class="bi bi-house-door-fill"></i>
                  Inicio
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link active fw-bold d-flex align-items-center gap-1"
                  href="web32insertdoctor.html"
                  aria-current="page"
                >
                  <i class="bi bi-plus-circle-fill"></i>
                  Insertar
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <main class="">
      <div class="container py-5">
        <h1 class="text-center mb-4 text-primary fw-bold">Crear Doctor</h1>
        <div class="row justify-content-center">
          <div class="col-md-10">
            <form class="card p-4 shadow-sm" id="formDoc">
              <div class="mb-3">
                <label for="apellido" class="form-label fw-bold"
                  >Apellido</label
                >
                <input
                  type="text"
                  id="apellido"
                  class="form-control"
                  placeholder="Apellido del doctor"
                />
              </div>
              <div class="mb-3">
                <label for="especialidad" class="form-label fw-bold"
                  >Especialidad</label
                >
                <select name="" class="form-select" id="especialidad"></select>
              </div>
              <div class="mb-3">
                <label for="hospital" class="form-label fw-bold"
                  >Hospital</label
                >
                <select name="" class="form-select" id="hospital"></select>
              </div>
              <div class="mb-3">
                <label for="salario" class="form-label fw-bold">Salario</label>
                <input
                  type="number"
                  id="salario"
                  class="form-control"
                  placeholder="Salario del doctor"
                />
              </div>

              <button type="submit" class="btn btn-primary w-100 fw-bold">
                <i class="bi bi-plus-circle-fill"></i> Crear Doctor
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>
    <footer></footer>
  </body>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery-3.7.1.js"></script>
  <script>
    let urlD = "https://apicruddoctores.azurewebsites.net/";
    let urlH = "https://apicrudhospital.azurewebsites.net/";

    $(document).ready(function () {
      loadEspecialidad();
      loadHospitales();

      $("#formDoc").submit(function (e) {
        e.preventDefault();
        inserDoc();
      });
    });

    function inserDoc() {
      let request = "api/Doctores";

      let apellido = $("#apellido").val();
      let especialidad = $("#especialidad").val();
      let hospital = parseInt($("#hospital").val());
      let salario = parseInt($("#salario").val());

      let doctor = new Object();

      doctor.idDoctor = 999;
      doctor.idHospital = hospital;
      doctor.apellido = apellido;
      doctor.especialidad = especialidad;
      doctor.salario = salario;

      let doctorJSON = JSON.stringify(doctor);
      console.log(doctorJSON)

      $.ajax({
        url: urlD + request,
        method:'POST',
        contentType: 'application/json',
        data: doctorJSON,
        success: function(){
            window.location.href = "web31practicaFinalDoctores.html"; 
        }
      });
    }

    function loadEspecialidad() {
      let request = "api/Doctores/Especialidades";
      $("#especialidad").empty();
      $.ajax({
        url: urlD + request,
        method: "GET",
        dataType: "json",
        success: function (data) {
          $.each(data, function (i, especialidad) {
            let $option = $("<option>", {
              value: especialidad,
              text: especialidad,
            });
            $("#especialidad").append($option);
          });
        },
      });
    }

    function loadHospitales() {
      let request = "webresources/hospitales";

      $("#hospital").empty();
      $.ajax({
        url: urlH + request,
        method: "GET",
        dataType: "json",
        success: function (data) {
          $.each(data, function (i, hospital) {
            let $option = $("<option>", {
              value: hospital.idhospital,
              text: hospital.nombre,
            });
            $("#hospital").append($option);
          });
        },
      });
    }
  </script>
</html>
