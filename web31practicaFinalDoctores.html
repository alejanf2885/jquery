<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hospitales</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
  </head>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    .atext-light:hover {
      color: white !important;
    }
  </style>
  <body>
    <header>
      <nav
        class="navbar navbar-expand-md navbar-dark bg-primary shadow-sm py-3"
      >
        <div class="container">
          <a
            class="navbar-brand fw-bold d-flex align-items-center gap-2"
            href="web31practicaFinalDoctores.html"
          >
            <i class="bi bi-hospital fs-4"></i>
            Doctores
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#collapsibleNavId"
            aria-controls="collapsibleNavId"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a
                  class="nav-link active fw-bold d-flex align-items-center gap-1"
                  href="web31practicaFinalDoctores.html"
                  aria-current="page"
                >
                  <i class="bi bi-house-door-fill"></i>
                  Inicio
                </a>
              </li>
              <li class="nav-item">
                <a
                  class="nav-link active fw-bold d-flex align-items-center gap-1"
                  href="web32insertdoctor.html"
                  aria-current="page"
                >
                  <i class="bi bi-plus-circle-fill"></i>
                  Insertar
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <main class="">
      <div class="container py-5">
        <div class="row justify-content-center align-middle">
          <div class="col-md-10">
            <div class="table-responsive-md shadow rounded">
              <table class="table table-bordered table-hover align-middle mb-0">
                <thead class="table-primary text-center">
                  <tr>
                    <th scope="col" class="fw-bold">Apellido</th>
                    <th scope="col" class="fw-bold">Especialidad</th>
                    <th scope="col" class="fw-bold">Salario</th>
                    <th scope="col" class="fw-bold">Acciones</th>
                  </tr>
                </thead>
                <tbody id="list" class="text-center"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer></footer>
  </body>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery-3.7.1.js"></script>
  <script>
    let url = "https://apicruddoctores.azurewebsites.net/";

    $(document).ready(function () {
      loadDoctores();
    });

    function loadDoctores() {
      let request = "api/Doctores";

      $.ajax({
        url: url + request,
        method: "GET",
        dataType: "json",
        success: function (data) {
          $("#list").empty();
          $.each(data, function (i, doctor) {
            let idDoctor = doctor.idDoctor;
            let idHospital = doctor.idHospital;
            let apellido = doctor.apellido;
            let especialidad = doctor.especialidad;
            let salario = doctor.salario;

            let $tr = $("<tr>");
            let $apellido = $("<td>", { text: apellido });
            let $especialidad = $("<td>", { text: especialidad });
            let $salario = $("<td>", { text: salario });
            let $acciones = $("<td>", {class: "text-center"});
            let $divAccion = $("<div>", {class: "d-flex justify-content-center"});
            let $btnEliminar = $("<button>", {
              class: "btn btn-danger btn-sm text-white fw-bold atext-light d-flex align-items-center gap-2 px-3 py-1",
              html: '<i class="bi bi-trash"></i> <span>Eliminar</span>',
              style: "box-shadow: 0 2px 6px rgba(0,0,0,0.08); border-radius: 0.5rem;"
            });
            $btnEliminar.on("click", function () {
              Swal.fire({
                title: "Delete?",
                text: "Are you sure about that?",
                icon: "question",
                showCloseButton: true,
                showCancelButton: true,
                focusConfirm: false,
                confirmButtonText: 'YES',
                confirmButtonColor: 'red',
                cancelButtonText: 'NO',
              }).then((result) => {
                if(result.isConfirmed){
                    deleteDoc(doctor.idDoctor);
                }
              });
            });

            $divAccion.append($btnEliminar);
            $acciones.append($divAccion);
            $tr.append($apellido, $especialidad, $salario, $acciones);
            $("#list").append($tr);
          });
        },
      });
    }


    function deleteDoc (id) {
        let request = '/api/Doctores/' + id;

        $.ajax({
            url:url+request,
            method:'DELETE',
            success:function(){
                loadDoctores();
            }
        })
    }
  </script>
</html>
